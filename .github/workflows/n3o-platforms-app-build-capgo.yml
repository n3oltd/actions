name: 'Build & Push Platforms App'

on:
  workflow_call:
    inputs:
      subscription-code:
        type: string
        required: true
        
env:
  GH_PAT: ${{ secrets.GH_PACKAGES_TOKEN }}

jobs:
  build-bundle:
    name: Build Bundle
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Fetch configuration.json
        uses: wei/wget@v1
        with:
          args: -O apps/platforms-app/src/configuration.json https://cdn.n3o.cloud/connect-${{ inputs.subscription-code }}/build/configuration.json

      - name: NPM install and build
        run: |
          npm clean-install
          npm run build
       
      - name: NPM 
        uses: n3oltd/actions/.github/actions/n3o-push-js-bundle-capgo@main
        with:
          bundle-name: cloud.n3o.platforms${{ inputs.subscription-code }}
          capgo-upload-api-key: ${{ secrets.CAPGO_API_KEY_UPLOAD }}
          upload-files-path: './apps/platforms-app/dist'
          package-json-path: './apps/platforms-app/package.json'